<!doctype html><html lang=fr-fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>AdRiLiNuX's web site | Mode rescue OVH</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.67.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css rel=stylesheet><meta property="og:title" content="Mode rescue OVH"><meta property="og:description" content="Pour des raisons de coût; mon infra repose sur de petits serveurs dédiés à prix promotionnel. J&rsquo;en ai actuellement un chez SoYouStart, mais ce qui suis est également valable pour des serveurs dédiés chez OVH (ainsi que Kimsufi). Une des particularités des serveurs dédiés pas cher, c&rsquo;est qu&rsquo;il n&rsquo;y a pas systématiquement de carte d&rsquo;accès à distance type Ilo ou Drac. Chez OVH, nous avons un système de rescue qui peut nous aider lorsque le serveur à un sérieux problème."><meta property="og:type" content="article"><meta property="og:url" content="https://www.reslinger.net/2020/08/mode-rescue-ovh/"><meta property="article:published_time" content="2020-08-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-21T00:00:00+00:00"><meta itemprop=name content="Mode rescue OVH"><meta itemprop=description content="Pour des raisons de coût; mon infra repose sur de petits serveurs dédiés à prix promotionnel. J&rsquo;en ai actuellement un chez SoYouStart, mais ce qui suis est également valable pour des serveurs dédiés chez OVH (ainsi que Kimsufi). Une des particularités des serveurs dédiés pas cher, c&rsquo;est qu&rsquo;il n&rsquo;y a pas systématiquement de carte d&rsquo;accès à distance type Ilo ou Drac. Chez OVH, nous avons un système de rescue qui peut nous aider lorsque le serveur à un sérieux problème."><meta itemprop=datePublished content="2020-08-21T00:00:00+00:00"><meta itemprop=dateModified content="2020-08-21T00:00:00+00:00"><meta itemprop=wordCount content="382"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Mode rescue OVH"><meta name=twitter:description content="Pour des raisons de coût; mon infra repose sur de petits serveurs dédiés à prix promotionnel. J&rsquo;en ai actuellement un chez SoYouStart, mais ce qui suis est également valable pour des serveurs dédiés chez OVH (ainsi que Kimsufi). Une des particularités des serveurs dédiés pas cher, c&rsquo;est qu&rsquo;il n&rsquo;y a pas systématiquement de carte d&rsquo;accès à distance type Ilo ou Drac. Chez OVH, nous avons un système de rescue qui peut nous aider lorsque le serveur à un sérieux problème."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=https://www.reslinger.net/ class="f3 fw2 hover-white no-underline white-90 dib">AdRiLiNuX's web site</a><div class="flex-l items-center"></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><p class="f6 b helvetica tracked">POSTS</p><h1 class="f1 athelas mb1">Mode rescue OVH</h1><time class="f6 mv4 dib tracked" datetime=2020-08-21T00:00:00Z>August 21, 2020</time></header><section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Pour des raisons de coût; mon infra repose sur de petits serveurs dédiés à prix promotionnel. J&rsquo;en ai actuellement un chez SoYouStart, mais ce qui suis est également valable pour des serveurs dédiés chez OVH (ainsi que Kimsufi).
Une des particularités des serveurs dédiés pas cher, c&rsquo;est qu&rsquo;il n&rsquo;y a pas systématiquement de carte d&rsquo;accès à distance type Ilo ou Drac. Chez OVH, nous avons un système de rescue qui peut nous aider lorsque le serveur à un sérieux problème.</p><p>Lors d&rsquo;un simple reboot, j&rsquo;ai perdu la main sur mon serveur, j&rsquo;ai donc lancer le mode rescue.
Une fois ce mode démarrer, on peut se connecter sur un système temporaire basé sur Debian en SSH pour essayer de comprendre ce qui ne va pas.
Petite parenthèse, un service web tourne sur le port 81 du système et permet de faire quelques test matériel. Les identifiants sont les même qu&rsquo;avec SSH (utilisateur root, mot de passe reçu par mail).</p><p>Le billet du jour à pour propos de traiter la collecte d&rsquo;informations pour le déboguage de la séquence de boot.</p><p>Mon système fonctionnait parfaitement avant que je le relance, le problème est lié à la séquence de boot et non à une panne matériel. Depuis la console SSH du mode rescue, j&rsquo;installe donc le nécessaire pour voir la séquence de boot. Le nécessaire est la virtualisation. C&rsquo;est parti.</p><p>Par habitude, je commence par mettre le système à jour</p><pre><code>apt update; apt upgrade -y
</code></pre><p>Je désactive le RAID disque de mes disques pour évité d&rsquo;avoir 2 systèmes qui accèdent aux mêmes données</p><pre><code>mdadm --manage --stop /dev/md127
</code></pre><p>Ensuite j&rsquo;installe le nécessaire pour lancer mon système dans une machine virtuelle</p><pre><code>apt install qemu-kvm libvirt-bin ovmf virtinst -y
</code></pre><p>Et je lance la virtualisation de mon système</p><pre><code>systemctl start libvirtd
virsh net-start default
virt-install --name rescue --hvm --vcpus=4 --ram 8192 --machine q35 --disk path=/dev/sda,bus=virtio,format=raw --disk path=/dev/sdb,bus=virtio,format=raw --disk path=/dev/sdc,bus=virtio,format=raw --disk path=/dev/sdd,bus=virtio,format=raw --network network:default,model=virtio --graphics spice --video qxl --channel spicevmc --rng /dev/random --noautoconsole --console pty,target_type=serial --os-type=linux --os-variant=rhel7 --import
</code></pre><p>Si la configuration de votre grub permet le contrôle depuis le port série, vous pouvez y accéder directement <a href=/2014/12/console-virsh/>depuis la console</a>. Autrement, installez les paquets suivant</p><pre><code>apt install virt-manager xauth
</code></pre><p>Après vous être reloggué, vous pourrez lancer virt-manager et avoir accès à la console et voir enfin pourquoi votre système ne démarre plus.</p><ul class=pa0></ul><div class=mt6><div id=commento></div><script defer src=https://commento.reslinger.net/js/commento.js></script></div></section><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.reslinger.net/>&copy; 2021 AdRiLiNuX's web site</a><div></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>