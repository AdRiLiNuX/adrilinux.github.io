<!doctype html><html lang=fr-fr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>AdRiLiNuX's web site | Déploiement d'un site Hugo sur Gitlab et Github</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.67.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css rel=stylesheet><meta property="og:title" content="Déploiement d'un site Hugo sur Gitlab et Github"><meta property="og:description" content="On y pense pas toujours, mais le temps de maintenance d&rsquo;un site peu vite prendre du temps. Bien qu&rsquo;avec un Wordpress ça se fasse simplement, il faut toujours suivre son site. L&rsquo;avantage des générateurs de site statiques est que la maintenance disparait. Alors comme beaucoup aujourd&rsquo;hui, j&rsquo;en ai adopté un il y a 2 ans environ. Tout fonctionneait parfaitement même si le thème par défaut que je n&rsquo;avais pas modifier ne me plaisais pas trop."><meta property="og:type" content="article"><meta property="og:url" content="https://www.reslinger.net/2019/09/d%C3%A9ploiement-dun-site-hugo-sur-gitlab-et-github/"><meta property="article:published_time" content="2019-09-03T08:51:19+02:00"><meta property="article:modified_time" content="2019-09-03T08:51:19+02:00"><meta itemprop=name content="Déploiement d'un site Hugo sur Gitlab et Github"><meta itemprop=description content="On y pense pas toujours, mais le temps de maintenance d&rsquo;un site peu vite prendre du temps. Bien qu&rsquo;avec un Wordpress ça se fasse simplement, il faut toujours suivre son site. L&rsquo;avantage des générateurs de site statiques est que la maintenance disparait. Alors comme beaucoup aujourd&rsquo;hui, j&rsquo;en ai adopté un il y a 2 ans environ. Tout fonctionneait parfaitement même si le thème par défaut que je n&rsquo;avais pas modifier ne me plaisais pas trop."><meta itemprop=datePublished content="2019-09-03T08:51:19+02:00"><meta itemprop=dateModified content="2019-09-03T08:51:19+02:00"><meta itemprop=wordCount content="422"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Déploiement d'un site Hugo sur Gitlab et Github"><meta name=twitter:description content="On y pense pas toujours, mais le temps de maintenance d&rsquo;un site peu vite prendre du temps. Bien qu&rsquo;avec un Wordpress ça se fasse simplement, il faut toujours suivre son site. L&rsquo;avantage des générateurs de site statiques est que la maintenance disparait. Alors comme beaucoup aujourd&rsquo;hui, j&rsquo;en ai adopté un il y a 2 ans environ. Tout fonctionneait parfaitement même si le thème par défaut que je n&rsquo;avais pas modifier ne me plaisais pas trop."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=https://www.reslinger.net/ class="f3 fw2 hover-white no-underline white-90 dib">AdRiLiNuX's web site</a><div class="flex-l items-center"></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><p class="f6 b helvetica tracked">POSTS</p><h1 class="f1 athelas mb1">Déploiement d'un site Hugo sur Gitlab et Github</h1><time class="f6 mv4 dib tracked" datetime=2019-09-03T08:51:19+02:00>September 3, 2019</time></header><section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>On y pense pas toujours, mais le temps de maintenance d&rsquo;un site peu vite prendre du temps. Bien qu&rsquo;avec un Wordpress ça se fasse simplement, il faut toujours suivre son site. L&rsquo;avantage des générateurs de site statiques est que la maintenance disparait. Alors comme beaucoup aujourd&rsquo;hui, <a href=/2017/10/hello-website-powered-by-lektor/>j&rsquo;en ai adopté un il y a 2 ans</a> environ. Tout fonctionneait parfaitement même si le thème par défaut que je n&rsquo;avais pas modifier ne me plaisais pas trop.</p><p>Aujourd&rsquo;hui, je vais vous parler de <a href=https://gohugo.io/>Hugo</a>. Ce générateur de site static est à la mode mais ce n&rsquo;est pas la seule raison de mon changement. Je suis un peu alergique au modification d&rsquo;un système d&rsquo;exploitation autrement que par son gestionnaire de paquet (à la rigueur j&rsquo;accepte la compilation de source installé dans /usr/local/). J&rsquo;ai donc exclu lektor à cause de pip.</p><p>Je passerai volontairement sur <a href=https://gohugo.io/getting-started/installing>l&rsquo;installation</a> et la <a href=https://gohugo.io/getting-started/quick-start/>création d&rsquo;un premier site</a> qui sont bien documentés.</p><p>L&rsquo;article du jour concerne le déploiement continu (alias CD) du site sur <a href=https://about.gitlab.com/product/pages/>Gitlab Pages</a> et <a href=https://pages.github.com/>Github Page</a> depuis Gitlab CI.</p><p>Pour un déploiement simple sur Gitlab, il n&rsquo;y a pas grand chose à faire pour que ça fonctionne. L&rsquo;exemple de .gitlab-ci.yml proposé sur le <a href=https://gohugo.io/hosting-and-deployment/hosting-on-gitlab/>site de hugo</a> fonctionne parfaitement.</p><p>Pour un déploiement en simultané sur Github, il va nous faloir générer une pair de clé ssh dédiée pour l&rsquo;opération. La commande suivante devrait nous permettre d&rsquo;y parvenir :</p><pre><code>ssh-keygen -t ed25519 -b 256 -f github
</code></pre><p>Le contenu de la clé publique sera utiliser pour créer une nouvelle clé de déploiement dans les préférences du projet Github :</p><p><img src=Github-ssh.png alt="Ajout d&rsquo;une clé dans un projet Github"></p><p>Le contenu de la clé privée sera, lui, utilisé comme variable dans l&rsquo;intégration et livraison continue du projet Gitlab au coté de l&rsquo;email et du login :</p><p><img src=Gitlab-CI-Variable.png alt="Ajout de la clé privée dans un projet Gitlab"></p><p>Maintenant il ne reste plus qu'à rajouter quelques lignes dans la section script du fichier .gitlab-ci.yml pour récupérer le dépôt depuis Github, nétoyer le répertoire et pushé le tout un fois le build fait.
Cela nous donne quelque chose comme ceci:</p><pre><code>pages:
    script:
    - mkdir -m 700 ~/.ssh; echo &quot;$GITHUB_KEY&quot; &gt; ~/.ssh/id_ed25519; chmod 600 ~/.ssh/id_ed25519; ssh-keyscan -t rsa github.com &gt;&gt; ~/.ssh/known_hosts
    - git clone git@github.com:${MY_NAME}/project_name.github.io.git public
    - rm -fr public/*
    - hugo
    - git config --global user.email &quot;$MY_EMAIL&quot;; git config --global user.name &quot;$MY_NAME&quot;
    - cd public; git add -A; git commit -m &quot;Auto update&quot;; git push --force
    artifacts:
        paths:
        - public
    only:
    - master
</code></pre><p>Edit: La synchronisation fonctionne bien et restera en l'état pour le moment, github gère son certificat let&rsquo;s encrypt lui même, ce qui ne permet pas de faire du loadbalancing pour le moment.</p><ul class=pa0></ul><div class=mt6><div id=commento></div><script defer src=https://commento.reslinger.net/js/commento.js></script></div></section><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.reslinger.net/>&copy; 2021 AdRiLiNuX's web site</a><div></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>